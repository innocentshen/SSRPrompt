# 方案 A 前端改动说明与线框图

> 本文档详细说明方案 A 涉及的所有前端改动，包含线框图辅助理解

---

## 目录

1. [改动概览](#1-改动概览)
2. [设置页面 - 模型能力配置](#2-设置页面---模型能力配置)
3. [Prompt 运行页面 - 推理选择器](#3-prompt-运行页面---推理选择器)
4. [Trace 详情 - 思考内容显示](#4-trace-详情---思考内容显示)
5. [组件清单](#5-组件清单)

---

## 1. 改动概览

### 1.1 涉及的页面

| 页面 | 改动内容 | 优先级 |
|------|----------|--------|
| 设置页面 `/settings` | 模型列表添加能力开关 | P0 |
| Prompt 编辑页 `/prompts/:id` | 添加推理强度选择器 | P0 |
| Trace 列表页 `/traces` | 显示思考内容标识 | P1 |
| Trace 详情弹窗 | 显示可折叠的思考内容 | P0 |

### 1.2 新增组件

```
src/components/
├── Common/
│   ├── ReasoningSelector.tsx    # 推理强度选择器
│   └── ThinkingDisplay.tsx      # 思考内容显示
└── Settings/
    └── ModelCapabilityBadges.tsx # 模型能力徽章（可选）
```

---

## 2. 设置页面 - 模型能力配置

### 2.1 当前状态

```
┌─────────────────────────────────────────────────────────────────┐
│  服务商配置                                          [启用] ○   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  服务商名称: [My OpenAI                    ]                    │
│                                                                 │
│  服务商类型: [OpenAI                      ▼]                    │
│                                                                 │
│  API Key:    [sk-xxxxx...                 ] [👁] [测试]         │
│                                                                 │
│  API 地址:   [https://api.openai.com       ]                    │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  模型管理                                      [🔄 自动获取]    │
├─────────────────────────────────────────────────────────────────┤
│  [模型 ID          ] [显示名称        ] [+]                     │
├─────────────────────────────────────────────────────────────────┤
│  │ gpt-4o                                                       │
│  │ gpt-4o                              [✓] 🖼 视觉    [🗑]      │
│  ├──────────────────────────────────────────────────────────────│
│  │ gpt-4o-mini                                                  │
│  │ gpt-4o-mini                         [✓] 🖼 视觉    [🗑]      │
│  ├──────────────────────────────────────────────────────────────│
│  │ o1-preview                                                   │
│  │ o1-preview                          [✓] 🖼 视觉    [🗑]      │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 改动后状态

```
┌─────────────────────────────────────────────────────────────────┐
│  服务商配置                                          [启用] ○   │
├─────────────────────────────────────────────────────────────────┤
│  ... (上方配置不变)                                             │
├─────────────────────────────────────────────────────────────────┤
│  模型管理                                      [🔄 自动获取]    │
├─────────────────────────────────────────────────────────────────┤
│  [模型 ID          ] [显示名称        ] [+]                     │
├─────────────────────────────────────────────────────────────────┤
│  │ gpt-4o                                                       │
│  │ gpt-4o              [✓]🖼视觉  [ ]🧠推理  [✓]🔧工具   [🗑]  │
│  ├──────────────────────────────────────────────────────────────│
│  │ gpt-4o-mini                                                  │
│  │ gpt-4o-mini         [✓]🖼视觉  [ ]🧠推理  [✓]🔧工具   [🗑]  │
│  ├──────────────────────────────────────────────────────────────│
│  │ o1-preview          ← 推理模型自动勾选                       │
│  │ o1-preview          [✓]🖼视觉  [✓]🧠推理  [ ]🔧工具   [🗑]  │
│  ├──────────────────────────────────────────────────────────────│
│  │ claude-3.7-sonnet                                            │
│  │ claude-3.7-sonnet   [✓]🖼视觉  [✓]🧠推理  [✓]🔧工具   [🗑]  │
└─────────────────────────────────────────────────────────────────┘

图例：
  🖼 视觉 = supports_vision（支持图片输入）
  🧠 推理 = supports_reasoning（支持思考/推理）
  🔧 工具 = supports_function_calling（支持工具调用）
```

### 2.3 交互说明

| 元素 | 交互 | 说明 |
|------|------|------|
| 能力复选框 | 点击切换 | 开启/关闭对应能力 |
| 自动获取 | 点击 | 获取模型列表时，根据模型名称自动推断能力 |
| 推理模型 | 自动识别 | o1/o3/claude-3.7+ 等自动勾选推理能力 |

### 2.4 紧凑布局（备选）

如果横向空间不足，可以使用徽章式布局：

```
┌─────────────────────────────────────────────────────────────────┐
│  │ gpt-4o                                                       │
│  │ gpt-4o                                              [🗑]     │
│  │ [🖼 视觉] [🔧 工具]                                          │
│  ├──────────────────────────────────────────────────────────────│
│  │ o1-preview                                                   │
│  │ o1-preview                                          [🗑]     │
│  │ [🖼 视觉] [🧠 推理]           ← 点击徽章可切换状态           │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. Prompt 运行页面 - 推理选择器

### 3.1 当前状态

```
┌─────────────────────────────────────────────────────────────────┐
│  PromptWizard - 测试提示词                                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 系统提示词                                               │   │
│  │ 你是一个有帮助的助手...                                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  变量:  {{topic}} = [人工智能          ]                        │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 用户输入                                                 │   │
│  │ 请解释一下 {{topic}} 的基本原理                          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  附件: [+ 添加文件]                                             │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  模型: [gpt-4o              ▼]              [▶ 运行]           │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 改动后状态

```
┌─────────────────────────────────────────────────────────────────┐
│  PromptWizard - 测试提示词                                      │
├─────────────────────────────────────────────────────────────────┤
│  ... (上方内容不变)                                             │
├─────────────────────────────────────────────────────────────────┤
│  模型: [o1-preview          ▼]  🧠 推理: [斟酌 ▼]   [▶ 运行]   │
│                                    │                            │
│                                    └── 仅当模型支持推理时显示   │
└─────────────────────────────────────────────────────────────────┘
```

### 3.3 推理选择器下拉菜单

```
┌─────────────────────────────────────────────────────────────────┐
│  模型: [claude-3.7-sonnet   ▼]  🧠 推理: [斟酌 ▼]   [▶ 运行]   │
│                                          │                      │
│                               ┌──────────┴──────────┐           │
│                               │ ○ 默认               │           │
│                               │   依赖模型默认行为   │           │
│                               ├─────────────────────┤           │
│                               │ ○ 关闭               │           │
│                               │   禁用推理           │           │
│                               ├─────────────────────┤           │
│                               │ ○ 浮想               │           │
│                               │   低强度推理         │           │
│                               ├─────────────────────┤           │
│                               │ ● 斟酌        ← 选中 │           │
│                               │   中强度推理         │           │
│                               ├─────────────────────┤           │
│                               │ ○ 沉思               │           │
│                               │   高强度推理         │           │
│                               └─────────────────────┘           │
└─────────────────────────────────────────────────────────────────┘
```

### 3.4 非推理模型状态

当选择不支持推理的模型时，推理选择器隐藏：

```
┌─────────────────────────────────────────────────────────────────┐
│  模型: [gpt-4o-mini         ▼]                      [▶ 运行]   │
│                                                                 │
│  （推理选择器不显示，因为 gpt-4o-mini 不支持推理）              │
└─────────────────────────────────────────────────────────────────┘
```

### 3.5 运行时状态

运行 Prompt 时，如果启用了推理，显示思考状态：

```
┌─────────────────────────────────────────────────────────────────┐
│  模型: [o1-preview          ▼]  🧠 推理: [沉思  ▼]   [⏹ 停止]  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 💡 思考中...                                      2.3s  │   │
│  │ ┌─────────────────────────────────────────────────────┐ │   │
│  │ │ 让我分析一下这个问题...                             │ │   │
│  │ │ 首先需要考虑...                                     │ │   │
│  │ │ █  ← 打字光标动画                                   │ │   │
│  │ └─────────────────────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 模型输出                                                 │   │
│  │ （等待思考完成后显示...）                                │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 3.6 运行完成状态

```
┌─────────────────────────────────────────────────────────────────┐
│  模型: [o1-preview          ▼]  🧠 推理: [沉思  ▼]   [▶ 运行]  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 💡 思考过程                                       3.2s ▶│   │
│  └─────────────────────────────────────────────────────────┘   │
│  ↑ 折叠状态，点击 ▶ 可展开查看                                 │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 模型输出                                                 │   │
│  │                                                          │   │
│  │ 人工智能（AI）的基本原理包括以下几个核心方面：          │   │
│  │                                                          │   │
│  │ 1. **机器学习**：通过数据训练模型...                    │   │
│  │ 2. **神经网络**：模拟人脑神经元结构...                  │   │
│  │ ...                                                      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  Token: 输入 1,234 / 输出 567    耗时: 4.5s                     │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. Trace 详情 - 思考内容显示

### 4.1 Trace 列表页

在列表中用图标标识包含思考内容的 Trace：

```
┌─────────────────────────────────────────────────────────────────┐
│  调用记录                                         [🔍 搜索...]  │
├─────────────────────────────────────────────────────────────────┤
│  时间          │ 模型           │ 状态   │ Token      │ 耗时   │
├─────────────────────────────────────────────────────────────────┤
│  12:34:56     │ o1-preview     │ ✓ 💡  │ 1.2K/567   │ 4.5s  │
│               │                │    ↑   │            │       │
│               │                │    思考│            │       │
├─────────────────────────────────────────────────────────────────┤
│  12:33:21     │ gpt-4o         │ ✓     │ 890/234    │ 1.2s  │
├─────────────────────────────────────────────────────────────────┤
│  12:32:05     │ claude-3.7     │ ✓ 💡  │ 2.1K/1.2K  │ 6.8s  │
└─────────────────────────────────────────────────────────────────┘

图例：
  ✓ = 成功
  💡 = 包含思考内容
```

### 4.2 Trace 详情弹窗

#### 无思考内容时（现有样式）

```
┌─────────────────────────────────────────────────────────────────┐
│  调用详情                                                  [×] │
├─────────────────────────────────────────────────────────────────┤
│  模型: gpt-4o           状态: ✓ 成功                           │
│  时间: 2025-12-25 12:33:21                                     │
│  Token: 输入 890 / 输出 234    耗时: 1.2s                       │
├─────────────────────────────────────────────────────────────────┤
│  输入                                                           │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 请解释一下人工智能的基本原理                            │   │
│  └─────────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────────┤
│  输出                                                           │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 人工智能（AI）是计算机科学的一个分支...                 │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

#### 有思考内容时（新增样式）

```
┌─────────────────────────────────────────────────────────────────┐
│  调用详情                                                  [×] │
├─────────────────────────────────────────────────────────────────┤
│  模型: o1-preview       状态: ✓ 成功                           │
│  时间: 2025-12-25 12:34:56                                     │
│  Token: 输入 1,234 / 输出 567    耗时: 4.5s                     │
├─────────────────────────────────────────────────────────────────┤
│  输入                                                           │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 请解释一下量子计算的工作原理                            │   │
│  └─────────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────────┤
│  💡 思考过程                                             3.2s  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ▼ 展开                                                  │ ← 默认折叠
│  └─────────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────────┤
│  输出                                                           │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 量子计算是一种利用量子力学原理进行计算的技术...         │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

#### 思考内容展开状态

```
┌─────────────────────────────────────────────────────────────────┐
│  💡 思考过程                                             3.2s  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ▲ 收起                                                  │   │
│  │                                                          │   │
│  │ 让我来分析一下量子计算的核心概念...                     │   │
│  │                                                          │   │
│  │ 首先，量子计算与经典计算的根本区别在于：               │   │
│  │ 1. 经典计算使用比特（0 或 1）                           │   │
│  │ 2. 量子计算使用量子比特（可以同时处于多个状态）         │   │
│  │                                                          │   │
│  │ 接下来需要解释叠加态和纠缠...                           │   │
│  │                                                          │   │
│  │ 叠加态意味着量子比特可以同时表示 0 和 1，这使得...     │   │
│  │ ...                                                      │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 5. 组件清单

### 5.1 ReasoningSelector 组件

**文件**: `src/components/Common/ReasoningSelector.tsx`

**Props**:
```typescript
interface ReasoningSelectorProps {
  value: ReasoningEffort;           // 当前选中的强度
  onChange: (v: ReasoningEffort) => void;
  disabled?: boolean;               // 运行时禁用
  size?: 'sm' | 'md';              // 尺寸
}
```

**样式规范**:
```
┌──────────────────────────┐
│ 🧠 推理: [斟酌        ▼] │  ← 正常状态
└──────────────────────────┘

┌──────────────────────────┐
│ 🧠 推理: [斟酌        ▼] │  ← 禁用状态（灰色）
└──────────────────────────┘
```

### 5.2 ThinkingDisplay 组件

**文件**: `src/components/Common/ThinkingDisplay.tsx`

**Props**:
```typescript
interface ThinkingDisplayProps {
  content: string;                  // 思考内容
  timeMs?: number;                  // 思考耗时（毫秒）
  isStreaming?: boolean;            // 是否正在流式输出
  defaultExpanded?: boolean;        // 默认是否展开
  maxHeight?: number;               // 展开时最大高度
}
```

**状态样式**:

```
# 流式输出中
┌─────────────────────────────────────────────┐
│ 💡 思考中...                          2.3s │  ← 灯泡图标有脉冲动画
│ ┌─────────────────────────────────────────┐ │
│ │ 内容实时更新...█                        │ │  ← 打字光标
│ └─────────────────────────────────────────┘ │
└─────────────────────────────────────────────┘

# 完成 - 折叠状态
┌─────────────────────────────────────────────┐
│ 💡 思考过程                           3.2s ▶│  ← 点击展开
└─────────────────────────────────────────────┘

# 完成 - 展开状态
┌─────────────────────────────────────────────┐
│ 💡 思考过程                           3.2s ▼│  ← 点击折叠
│ ┌─────────────────────────────────────────┐ │
│ │ 完整的思考内容...                       │ │
│ │ 可滚动查看...                           │ │
│ └─────────────────────────────────────────┘ │
└─────────────────────────────────────────────┘
```

### 5.3 ModelCapabilityToggles 组件

**文件**: `src/components/Settings/ModelCapabilityToggles.tsx`

**Props**:
```typescript
interface ModelCapabilityTogglesProps {
  supportsVision: boolean;
  supportsReasoning: boolean;
  supportsFunctionCalling: boolean;
  onToggleVision: (v: boolean) => void;
  onToggleReasoning: (v: boolean) => void;
  onToggleFunctionCalling: (v: boolean) => void;
  disabled?: boolean;
}
```

**样式**:
```
[✓]🖼视觉  [✓]🧠推理  [ ]🔧工具

或紧凑版：

[🖼 视觉] [🧠 推理]  ← 徽章样式，点击切换
```

---

## 6. 颜色规范

| 元素 | 暗色主题 | 亮色主题 |
|------|----------|----------|
| 推理图标 🧠 | `text-cyan-400` | `text-cyan-600` |
| 思考图标 💡 (静止) | `text-slate-400` | `text-slate-500` |
| 思考图标 💡 (动画) | `text-yellow-400` | `text-yellow-500` |
| 思考容器背景 | `bg-slate-800/50` | `bg-amber-50` |
| 思考容器边框 | `border-slate-700` | `border-amber-200` |
| 徽章-启用 | `bg-cyan-500/20 text-cyan-400` | `bg-cyan-100 text-cyan-700` |
| 徽章-禁用 | `bg-slate-700 text-slate-500` | `bg-slate-200 text-slate-500` |

---

## 7. 交互流程图

### 7.1 运行 Prompt 流程

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  选择模型   │────▶│ 检查是否支持 │────▶│  显示/隐藏  │
│             │     │    推理     │     │  推理选择器 │
└─────────────┘     └─────────────┘     └─────────────┘
                                               │
                                               ▼
                    ┌─────────────┐     ┌─────────────┐
                    │  选择强度   │◀────│  用户操作   │
                    │  (可选)     │     │             │
                    └─────────────┘     └─────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │  点击运行   │
                    └─────────────┘
                           │
              ┌────────────┴────────────┐
              │                         │
              ▼                         ▼
     ┌─────────────┐           ┌─────────────┐
     │ 无推理参数  │           │ 带推理参数  │
     │ 直接请求    │           │ 请求 API    │
     └─────────────┘           └─────────────┘
              │                         │
              │                         ▼
              │                ┌─────────────┐
              │                │ 显示思考中  │
              │                │ 实时更新    │
              │                └─────────────┘
              │                         │
              └────────────┬────────────┘
                           ▼
                    ┌─────────────┐
                    │  显示结果   │
                    │ (含思考内容)│
                    └─────────────┘
```

### 7.2 保存 Trace 流程

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  响应完成   │────▶│  提取思考   │────▶│  分离存储   │
│             │     │  内容       │     │             │
└─────────────┘     └─────────────┘     └─────────────┘
                                               │
                           ┌───────────────────┴───────────────────┐
                           ▼                                       ▼
                    ┌─────────────┐                         ┌─────────────┐
                    │ output 字段 │                         │thinking_content│
                    │ 正式回复    │                         │ 思考内容      │
                    └─────────────┘                         └─────────────┘
```

---

## 8. 文件改动清单

| 文件 | 改动类型 | 改动说明 |
|------|----------|----------|
| `src/components/Common/ReasoningSelector.tsx` | 新建 | 推理强度选择器 |
| `src/components/Common/ThinkingDisplay.tsx` | 新建 | 思考内容显示 |
| `src/components/Settings/ProviderForm.tsx` | 修改 | 添加能力开关 |
| `src/pages/PromptWizardPage.tsx` | 修改 | 集成推理选择器和思考显示 |
| `src/pages/TracesPage.tsx` | 修改 | 列表添加思考标识 |
| `src/components/Prompt/DebugHistory.tsx` | 修改 | 详情弹窗添加思考内容 |

---

*文档日期: 2025-12-25*
